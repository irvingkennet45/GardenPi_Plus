<!DOCTYPE html>
<html lang="en-US">
<head>
	<title>GardenPi Portal - Overview</title>
	<meta charset="UTF-8">
	<link rel="stylesheet" href="../styles.css">
        <link rel="icon" type="image/x-icon" href="https://raw.githubusercontent.com/irvingkennet45/GardenPi_Plus/refs/heads/main/assets/favicon.ico">
        <link rel="manifest" href="/manifest.json">
        <link href="https://fonts.googleapis.com/css2?family=Mulish:wght@300;400;600;700&display=swap" rel="stylesheet">
        <script src="../simplelogic.js"></script>
</head>
<body>

<nav class="topNavBar">
  <div class="navGPiContainer">
    <div class="navLogo">
      <a href="/overview">
        <img src="https://github.com/irvingkennet45/GardenPi_Plus/blob/main/assets/garden.gif?raw=true" alt="GardenPi+" class="logoIcon">
      </a>
    </div>
    <div class="navGPi">
      <h1>GardenPi+ Portal</h1>
    </div>
  </div>
  <div class="navMain">
    <div class="navContainer">
      <div class="navLinks">
        <a href="../overview">Overview</a>
        <a href="../controller">Controller</a>
        <a href="../data">Data</a>
        <a href="../weather-data">Weather</a>
        <a href="../console">Console</a>
        <a href="../about">About</a>
      </div>
      <div class="navRight">
        <div class="navClock">
          <p><span id="clockTime">--:--:--</span></p>
        </div>
        <div class="navToggle">
          <label class="switch">
            <input type="checkbox" id="themeToggle">
            <span class="slider">
              <span class="icon sun">‚òÄÔ∏è</span>
              <span class="icon moon">üåô</span>
            </span>
          </label>
        </div>
      </div>
    </div>
  </div>
</nav>

<h1 class="mainHeader">Overview</h1>

<div class="dashboardContainer">
  <div class="dashboardStatusContainer">
    <h2 class="mainHeroHeader">Status</h2>
    <ul class="statusList">
      <li>Internal Temp: <span id="temp">--</span></li>
      <li>RAM Usage: <span id="ram">--</span></li>
      <li>Storage Free: <span id="storage">--</span></li>
      <li>Automation: <span id="auto">--</span></li>
      <li>Mist: <span id="mist">--</span></li>
    </ul>
  </div>
  <div class="dashboardForecastContainer">
    <h2 class="mainHeroHeader">Upcoming Forecast</h2>
  </div>
</div>

<script>
async function loadStatus(){
  const res = await fetch('/api/info');
  const data = await res.json();
  if('temperature_c' in data){
    document.getElementById('temp').textContent = data.temperature_c + ' C';
  }
  if('mem_total' in data && 'mem_free' in data){
    const used = data.mem_total - data.mem_free;
    document.getElementById('ram').textContent = used + '/' + data.mem_total;
  }
  if('storage_free' in data && 'storage_total' in data){
    document.getElementById('storage').textContent = data.storage_free + '/' + data.storage_total;
  }
  if('automation_enabled' in data){
    document.getElementById('auto').textContent = data.automation_enabled ? 'On' : 'Off';
  }
  if('mist_active' in data){
    document.getElementById('mist').textContent = data.mist_active ? 'Running' : 'Idle';
  }
}
async function loadForecast(){
  try{
    const res = await fetch('/api/weather_log');
    const data = await res.json();
    const entry = (data.log || []).slice(-1)[0];
    if(!entry) return;
    const container = document.querySelector('.dashboardForecastContainer');
    entry.periods.forEach(p=>{
      const div = document.createElement('div');
      div.className = 'forecastDay';
      div.innerHTML = `<strong>${p.name}</strong><br>${p.temperature}¬∞${p.temperatureUnit}<br>${p.shortForecast}`;
      container.appendChild(div);
    });
  }catch(e){
    console.error('forecast load failed',e);
  }
}
document.addEventListener('DOMContentLoaded', ()=>{loadStatus(); loadForecast();});
</script>

</body>
</html>

<!--Not in use yet. Will be able to serve quick data from the main sensors, such as internal temperature.-->